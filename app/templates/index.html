<!DOCTYPE html>
<html>
<head>
    <title>Roleta</title>
    
    {% load static %}
    <script type="text/javascript" src="{% static '/js/roleta.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.0"></script>

    <style>
        canvas#rouletteChart {
            max-width: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body class="bg-dark text-light">
    <div class="container">
        <h3>Wallet Balance: $<span id="walletBalance"></span></h3>
        <div class="input-group mb-3">
            <input id="amountInput" type="number" min="0" placeholder="Enter amount" class="form-control">
            <button onclick="addToWallet()" class="btn btn-primary">Add Funds</button>
        </div>
        <p id="wallet"></p>
    </div>

    <div class="container d-flex justify-content-center align-items-center">
        <canvas id="rouletteChart"></canvas>
    </div>

    <div class="container">
        <select id="colorSelect" class="form-select mb-3">
            <option value="red">Vermelho</option>
            <option value="orange">Laranja</option>
            <option value="yellow">Amarelo</option>
            <option value="green">Verde</option>
            <option value="blue">Azul</option>
            <option value="indigo">Indigo</option>
            <option value="violet">Violeta</option>
            <option value="pink">Rosa</option>
        </select>

        <input id="valorAposta" type="number" min="0" placeholder="Valor da aposta" class="form-control mb-3">

        <button onclick="apostar()" class="btn btn-primary">Apostar</button>

        <h2 id="resultado"></h2>

        <h3>Multiplicadores:</h3>
        <ul id="multiplicadores" class="list-group">
            <li class="list-group-item">Red: <span id="red" class="multiplier">1.25</span></li>
            <li class="list-group-item">Orange: <span id="orange" class="multiplier">1.5</span></li>
            <li class="list-group-item">Yellow: <span id="yellow" class="multiplier">1.75</span></li>
            <li class="list-group-item">Green: <span id="green" class="multiplier">1.2</span></li>
            <li class="list-group-item">Blue: <span id="blue" class="multiplier">2</span></li>
            <li class="list-group-item">Indigo: <span id="indigo" class="multiplier">1.3</span></li>
            <li class="list-group-item">Violet: <span id="violet" class="multiplier">1.8</span></li>
            <li class="list-group-item">Pink: <span id="pink" class="multiplier">1.4</span></li>
        </ul>

        <button onclick="initializeMultiplicadores()" class="btn btn-primary">Jogar novamente</button>
    </div>

    <script>
        const labels = ['Red', 'Orange', 'Yellow', 'Green', 'Blue', 'Indigo', 'Violet', 'Pink'];
        const data = [1, 1, 1, 1, 1, 1, 1, 1];
        const colors = ['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet', 'pink'];

        let rouletteChart = null;

        function initializeRouletteChart() {
            rouletteChart = new Chart('rouletteChart', {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function clearRouletteChart() {
            if (rouletteChart !== null) {
                rouletteChart.destroy();
                rouletteChart = null;
            }
            initializeRouletteChart();
        }

        function spinRoulette() {
            const spinCount = 30; // Número de giros
            const spinDuration = 100; // Duração de cada giro em milissegundos
            let spinIndex = 0; // Índice de giro atual

            const spinInterval = setInterval(() => {
                // Atualizar o gráfico da roleta com os novos valores
                const currentIndex = spinIndex % labels.length;
                data[currentIndex] += 1;
                rouletteChart.update();

                // Atualizar o resultado da roleta com a cor atual
                const resultadoElement = document.getElementById('resultado');
                resultadoElement.innerText = `Resultado: ${colors[currentIndex]}`;

                spinIndex++;

                if (spinIndex === spinCount) {
                    clearInterval(spinInterval);
                }
            }, spinDuration);
        }

        function apostar() {
            const valorAposta = parseInt(document.getElementById('valorAposta').value);
            if (valorAposta > 0) {
                clearRouletteChart(); // Reiniciar o gráfico da roleta
                // Chame a função spinRoulette() para girar a roleta após o jogador fazer a aposta
                spinRoulette();
            } else {
                alert('Por favor, insira um valor de aposta válido.');
            }
        }

        initializeRouletteChart(); // Inicializar o gráfico da roleta ao carregar a página
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
